var J=Object.defineProperty;var T=Object.prototype.hasOwnProperty;var C=Object.getOwnPropertySymbols,O=Object.prototype.propertyIsEnumerable;var E=(e,t,r)=>t in e?J(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,v=(e,t)=>{for(var r in t||(t={}))T.call(t,r)&&E(e,r,t[r]);if(C)for(var r of C(t))O.call(t,r)&&E(e,r,t[r]);return e};var I=(e,t)=>{var r={};for(var n in e)T.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(e!=null&&C)for(var n of C(e))t.indexOf(n)<0&&O.call(e,n)&&(r[n]=e[n]);return r};import{a as Z}from"../../common/index-e8f309a6.js";import{c as $}from"../../common/_commonjsHelpers-4f955397.js";import"../../common/process-2545f00a.js";import"../../common/_polyfill-node:global-acbc543a.js";async function K(e){const t=await e.store.length();if(t<e.limit)return;e.debug(`Current store size: ${t}`);let r;await e.store.iterate((n,c)=>{r||(r={value:n,key:c}),n.expires<r.value.expires&&(r={value:n,key:c})}),r&&(e.debug(`Removing item: ${r.key}`),await e.store.removeItem(r.key))}function A(e){const t=typeof e;return e!=null&&(t==="object"||t==="function")}function k(e){return e===null?e===void 0?"[object Undefined]":"[object Null]":Object.prototype.toString.call(e)}function F(e){if(!A(e))return!1;const t=k(e);return t==="[object Function]"||t==="[object AsyncFunction]"||t==="[object GeneratorFunction]"||t==="[object Proxy]"}function Q(e){const t=typeof e;return t==="string"||t==="object"&&e!=null&&!Array.isArray(e)&&k(e)==="[object String]"}function W(e,t){return A(e)?Object.keys(e).map(r=>t(e[r],r)):[]}var X=$(function(e){(function(){var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",r={rotl:function(n,c){return n<<c|n>>>32-c},rotr:function(n,c){return n<<32-c|n>>>c},endian:function(n){if(n.constructor==Number)return r.rotl(n,8)&16711935|r.rotl(n,24)&4278255360;for(var c=0;c<n.length;c++)n[c]=r.endian(n[c]);return n},randomBytes:function(n){for(var c=[];n>0;n--)c.push(Math.floor(Math.random()*256));return c},bytesToWords:function(n){for(var c=[],h=0,f=0;h<n.length;h++,f+=8)c[f>>>5]|=n[h]<<24-f%32;return c},wordsToBytes:function(n){for(var c=[],h=0;h<n.length*32;h+=8)c.push(n[h>>>5]>>>24-h%32&255);return c},bytesToHex:function(n){for(var c=[],h=0;h<n.length;h++)c.push((n[h]>>>4).toString(16)),c.push((n[h]&15).toString(16));return c.join("")},hexToBytes:function(n){for(var c=[],h=0;h<n.length;h+=2)c.push(parseInt(n.substr(h,2),16));return c},bytesToBase64:function(n){for(var c=[],h=0;h<n.length;h+=3)for(var f=n[h]<<16|n[h+1]<<8|n[h+2],d=0;d<4;d++)h*8+d*6<=n.length*8?c.push(t.charAt(f>>>6*(3-d)&63)):c.push("=");return c.join("")},base64ToBytes:function(n){n=n.replace(/[^A-Z0-9+\/]/ig,"");for(var c=[],h=0,f=0;h<n.length;f=++h%4)f!=0&&c.push((t.indexOf(n.charAt(h-1))&Math.pow(2,-2*f+8)-1)<<f*2|t.indexOf(n.charAt(h))>>>6-f*2);return c}};e.exports=r})()}),R={utf8:{stringToBytes:function(e){return R.bin.stringToBytes(unescape(encodeURIComponent(e)))},bytesToString:function(e){return decodeURIComponent(escape(R.bin.bytesToString(e)))}},bin:{stringToBytes:function(e){for(var t=[],r=0;r<e.length;r++)t.push(e.charCodeAt(r)&255);return t},bytesToString:function(e){for(var t=[],r=0;r<e.length;r++)t.push(String.fromCharCode(e[r]));return t.join("")}}},B=R;/*!
 * Determine if an object is a Buffer
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */var V=function(e){return e!=null&&(L(e)||Y(e)||!!e._isBuffer)};function L(e){return!!e.constructor&&typeof e.constructor.isBuffer=="function"&&e.constructor.isBuffer(e)}function Y(e){return typeof e.readFloatLE=="function"&&typeof e.slice=="function"&&L(e.slice(0,0))}var _=$(function(e){(function(){var t=X,r=B.utf8,n=V,c=B.bin,h=function(f,d){f.constructor==String?d&&d.encoding==="binary"?f=c.stringToBytes(f):f=r.stringToBytes(f):n(f)?f=Array.prototype.slice.call(f,0):!Array.isArray(f)&&f.constructor!==Uint8Array&&(f=f.toString());for(var a=t.bytesToWords(f),S=f.length*8,u=1732584193,s=-271733879,i=-1732584194,o=271733878,l=0;l<a.length;l++)a[l]=(a[l]<<8|a[l]>>>24)&16711935|(a[l]<<24|a[l]>>>8)&4278255360;a[S>>>5]|=128<<S%32,a[(S+64>>>9<<4)+14]=S;for(var p=h._ff,y=h._gg,x=h._hh,g=h._ii,l=0;l<a.length;l+=16){var H=u,z=s,N=i,G=o;u=p(u,s,i,o,a[l+0],7,-680876936),o=p(o,u,s,i,a[l+1],12,-389564586),i=p(i,o,u,s,a[l+2],17,606105819),s=p(s,i,o,u,a[l+3],22,-1044525330),u=p(u,s,i,o,a[l+4],7,-176418897),o=p(o,u,s,i,a[l+5],12,1200080426),i=p(i,o,u,s,a[l+6],17,-1473231341),s=p(s,i,o,u,a[l+7],22,-45705983),u=p(u,s,i,o,a[l+8],7,1770035416),o=p(o,u,s,i,a[l+9],12,-1958414417),i=p(i,o,u,s,a[l+10],17,-42063),s=p(s,i,o,u,a[l+11],22,-1990404162),u=p(u,s,i,o,a[l+12],7,1804603682),o=p(o,u,s,i,a[l+13],12,-40341101),i=p(i,o,u,s,a[l+14],17,-1502002290),s=p(s,i,o,u,a[l+15],22,1236535329),u=y(u,s,i,o,a[l+1],5,-165796510),o=y(o,u,s,i,a[l+6],9,-1069501632),i=y(i,o,u,s,a[l+11],14,643717713),s=y(s,i,o,u,a[l+0],20,-373897302),u=y(u,s,i,o,a[l+5],5,-701558691),o=y(o,u,s,i,a[l+10],9,38016083),i=y(i,o,u,s,a[l+15],14,-660478335),s=y(s,i,o,u,a[l+4],20,-405537848),u=y(u,s,i,o,a[l+9],5,568446438),o=y(o,u,s,i,a[l+14],9,-1019803690),i=y(i,o,u,s,a[l+3],14,-187363961),s=y(s,i,o,u,a[l+8],20,1163531501),u=y(u,s,i,o,a[l+13],5,-1444681467),o=y(o,u,s,i,a[l+2],9,-51403784),i=y(i,o,u,s,a[l+7],14,1735328473),s=y(s,i,o,u,a[l+12],20,-1926607734),u=x(u,s,i,o,a[l+5],4,-378558),o=x(o,u,s,i,a[l+8],11,-2022574463),i=x(i,o,u,s,a[l+11],16,1839030562),s=x(s,i,o,u,a[l+14],23,-35309556),u=x(u,s,i,o,a[l+1],4,-1530992060),o=x(o,u,s,i,a[l+4],11,1272893353),i=x(i,o,u,s,a[l+7],16,-155497632),s=x(s,i,o,u,a[l+10],23,-1094730640),u=x(u,s,i,o,a[l+13],4,681279174),o=x(o,u,s,i,a[l+0],11,-358537222),i=x(i,o,u,s,a[l+3],16,-722521979),s=x(s,i,o,u,a[l+6],23,76029189),u=x(u,s,i,o,a[l+9],4,-640364487),o=x(o,u,s,i,a[l+12],11,-421815835),i=x(i,o,u,s,a[l+15],16,530742520),s=x(s,i,o,u,a[l+2],23,-995338651),u=g(u,s,i,o,a[l+0],6,-198630844),o=g(o,u,s,i,a[l+7],10,1126891415),i=g(i,o,u,s,a[l+14],15,-1416354905),s=g(s,i,o,u,a[l+5],21,-57434055),u=g(u,s,i,o,a[l+12],6,1700485571),o=g(o,u,s,i,a[l+3],10,-1894986606),i=g(i,o,u,s,a[l+10],15,-1051523),s=g(s,i,o,u,a[l+1],21,-2054922799),u=g(u,s,i,o,a[l+8],6,1873313359),o=g(o,u,s,i,a[l+15],10,-30611744),i=g(i,o,u,s,a[l+6],15,-1560198380),s=g(s,i,o,u,a[l+13],21,1309151649),u=g(u,s,i,o,a[l+4],6,-145523070),o=g(o,u,s,i,a[l+11],10,-1120210379),i=g(i,o,u,s,a[l+2],15,718787259),s=g(s,i,o,u,a[l+9],21,-343485551),u=u+H>>>0,s=s+z>>>0,i=i+N>>>0,o=o+G>>>0}return t.endian([u,s,i,o])};h._ff=function(f,d,a,S,u,s,i){var o=f+(d&a|~d&S)+(u>>>0)+i;return(o<<s|o>>>32-s)+d},h._gg=function(f,d,a,S,u,s,i){var o=f+(d&S|a&~S)+(u>>>0)+i;return(o<<s|o>>>32-s)+d},h._hh=function(f,d,a,S,u,s,i){var o=f+(d^a^S)+(u>>>0)+i;return(o<<s|o>>>32-s)+d},h._ii=function(f,d,a,S,u,s,i){var o=f+(a^(d|~S))+(u>>>0)+i;return(o<<s|o>>>32-s)+d},h._blocksize=16,h._digestsize=16,e.exports=function(f,d){if(f==null)throw new Error("Illegal argument "+f);var a=t.wordsToBytes(h(f,d));return d&&d.asBytes?a:d&&d.asString?c.bytesToString(a):t.bytesToHex(a)}})()});function q(e,t,r){if(r.data)try{r.data=JSON.parse(r.data)}catch(f){e.debug("Could not parse data as JSON",f)}const{request:n,config:c}=r;return I(r,["request","config"])}async function ee(e,t,r){try{const n={expires:e.expires,data:q(e,t,r)};await e.store.setItem(e.uuid,n)}catch(n){if(e.debug("Could not store response",n),e.clearOnError)try{await e.store.clear()}catch(c){e.debug("Could not clear store",c)}return!1}return!0}async function te(e,t){const{uuid:r,ignoreCache:n}=e,c=await e.store.getItem(r);if(n||!c||!c.data){e.debug("cache-miss",t.url);const a=new Error;throw a.reason="cache-miss",a.message="Entry not found from cache",a}const{expires:h,data:f}=c;if(!(typeof navigator!="undefined"&&"onLine"in navigator&&!navigator.onLine)&&!e.acceptStale&&h!==0&&h<Date.now()){e.debug("cache-stale",t.url);const a=new Error;throw a.reason="cache-stale",a.message="Entry is stale",a}return e.debug(e.acceptStale?"cache-hit-stale":"cache-hit",t.url),f}function j(e){if(F(e.key))return e.key;let t;return Q(e.key)?t=r=>{const n=`${r.baseURL?r.baseURL:""}${r.url}`,c=`${e.key}/${n}${U(r)}`;return r.data?c+_(r.data):c}:t=r=>{const c=`${r.baseURL?r.baseURL:""}${r.url}`+U(r);return r.data?c+_(r.data):c},t}async function re(e,t){const r=t.method.toLowerCase();e.exclude.methods.includes(r)&&await e.store.removeItem(e.uuid)}function ne(e={}){return F(e.invalidate)?e.invalidate:re}function U(e){if(!e.params)return"";if(typeof URLSearchParams=="undefined")return JSON.stringify(e.params);let t=e.params;return e.params instanceof URLSearchParams||(t=new URLSearchParams,Object.keys(e.params).forEach(n=>t.append(n,e.params[n]))),`?${t.toString()}`}const ae=/([a-zA-Z][a-zA-Z_-]*)\s*(?:=(?:"([^"]*)"|([^ \t",;]*)))?/g,m={maxAge:"max-age",sharedMaxAge:"s-maxage",maxStale:"max-stale",minFresh:"min-fresh",immutable:"immutable",mustRevalidate:"must-revalidate",noCache:"no-cache",noStore:"no-store",noTransform:"no-transform",onlyIfCached:"only-if-cached",private:"private",proxyRevalidate:"proxy-revalidate",public:"public"};function b(e){return e===null}function w(e){if(!e)return null;const t=parseInt(e,10);return!Number.isFinite(t)||t<0?null:t}class se{constructor(){this.maxAge=null,this.sharedMaxAge=null,this.maxStale=null,this.maxStaleDuration=null,this.minFresh=null,this.immutable=null,this.mustRevalidate=null,this.noCache=null,this.noStore=null,this.noTransform=null,this.onlyIfCached=null,this.private=null,this.proxyRevalidate=null,this.public=null}parse(t){if(!t||t.length===0)return this;const r={},n=t.match(ae)||[];return Array.prototype.forEach.call(n,c=>{const h=c.split("=",2),[f]=h;let d=null;h.length>1&&(d=h[1].trim()),r[f.toLowerCase()]=d}),this.maxAge=w(r[m.maxAge]),this.sharedMaxAge=w(r[m.sharedMaxAge]),this.maxStale=b(r[m.maxStale]),this.maxStaleDuration=w(r[m.maxStale]),this.maxStaleDuration&&(this.maxStale=!0),this.minFresh=w(r[m.minFresh]),this.immutable=b(r[m.immutable]),this.mustRevalidate=b(r[m.mustRevalidate]),this.noCache=b(r[m.noCache]),this.noStore=b(r[m.noStore]),this.noTransform=b(r[m.noTransform]),this.onlyIfCached=b(r[m.onlyIfCached]),this.private=b(r[m.private]),this.proxyRevalidate=b(r[m.proxyRevalidate]),this.public=b(r[m.public]),this}format(){const t=[];return this.maxAge&&t.push(`${m.maxAge}=${this.maxAge}`),this.sharedMaxAge&&t.push(`${m.sharedMaxAge}=${this.sharedMaxAge}`),this.maxStale&&(this.maxStaleDuration?t.push(`${m.maxStale}=${this.maxStaleDuration}`):t.push(m.maxStale)),this.minFresh&&t.push(`${m.minFresh}=${this.minFresh}`),this.immutable&&t.push(m.immutable),this.mustRevalidate&&t.push(m.mustRevalidate),this.noCache&&t.push(m.noCache),this.noStore&&t.push(m.noStore),this.noTransform&&t.push(m.noTransform),this.onlyIfCached&&t.push(m.onlyIfCached),this.private&&t.push(m.private),this.proxyRevalidate&&t.push(m.proxyRevalidate),this.public&&t.push(m.public),t.join(", ")}}function oe(e){return new se().parse(e)}async function ue(e,t,r){const{request:n={},headers:c={}}=r;if(["arraybuffer","blob"].indexOf(n.responseType)>-1)return r;let h={};return e.readHeaders&&(c["cache-control"]?(h=oe(c["cache-control"]),(h.noCache||h.noStore)&&(e.excludeFromCache=!0)):c.expires?e.expires=new Date(c.expires).getTime():e.expires=new Date().getTime()),e.excludeFromCache?r.request.excludedFromCache=!0:(h.maxAge||h.maxAge===0?e.expires=Date.now()+h.maxAge*1e3:e.readHeaders||(e.expires=e.maxAge===0?Date.now():Date.now()+e.maxAge),e.limit&&(e.debug(`Detected limit: ${e.limit}`),await K(e)),await ee(e,t,r)),r}function ie(e={},t){const{exclude:r={},debug:n}=e,c=t.method.toLowerCase();if(c==="head"||r.methods.includes(c))return n(`Excluding request by HTTP method ${t.url}`),!0;if(typeof r.filter=="function"&&r.filter(t))return n(`Excluding request by filter ${t.url}`),!0;const h=/\?.*$/.test(t.url)||A(t.params)&&Object.keys(t.params).length!==0||typeof URLSearchParams!="undefined"&&t.params instanceof URLSearchParams;return r.query&&h?(n(`Excluding request by query ${t.url}`),!0):(r.paths||[]).some(a=>t.url.match(a))?(n(`Excluding request by url match ${t.url}`),!0):!1}async function D(e,t){e.debug("uuid",e.uuid);const r=(...c)=>ue(e,t,...c);if(await e.invalidate(e,t),ie(e,t))return n();try{const c=await te(e,t);return c.config=t,c.request={fromCache:!0},{config:e,next:c}}catch(c){return e.clearOnStale&&c.reason==="cache-stale"&&await e.store.removeItem(e.uuid),{config:e,next:r}}function n(){return e.excludeFromCache=!0,{config:e,next:r}}}class ce{constructor(){this.store={}}async getItem(t){const r=this.store[t]||null;return JSON.parse(r)}async setItem(t,r){return this.store[t]=JSON.stringify(r),r}async removeItem(t){delete this.store[t]}async clear(){this.store={}}async length(){return Object.keys(this.store).length}iterate(t){return Promise.all(W(this.store,t))}}const le=()=>{},P=(...e)=>console.log("[axios-cache-adapter]",...e),M={cache:{maxAge:0,limit:!1,store:null,key:null,invalidate:null,exclude:{paths:[],query:!0,filter:null,methods:["post","patch","put","delete"]},adapter:Z.defaults.adapter,clearOnStale:!0,clearOnError:!0,readOnError:!1,readHeaders:!1,debug:!1,ignoreCache:!1},axios:{cache:{maxAge:15*60*1e3}}},he=["limit","store","adapter","uuid","acceptStale"],fe=function(e={}){const t=v(v(v({},M.cache),e),{exclude:v(v({},M.cache.exclude),e.exclude)});return t.key=j(t),t.invalidate=ne(t),t.debug!==!1?t.debug=typeof t.debug=="function"?t.debug:P:t.debug=le,t.store||(t.store=new ce),t.debug("Global cache config",t),t},de=function(e,t){const r=t.cache||{};r&&he.forEach(c=>r[c]?delete r[c]:void 0);const n=v(v(v({},e),r),{exclude:v(v({},e.exclude),r.exclude)});return n.debug===!0&&(n.debug=P),r.key&&(n.key=j(r)),n.uuid=n.key(t),e.debug(`Request config for ${t.url}`,n),n};function me(e={}){e=fe(e);async function t(r){const n=de(e,r);let c=await D(n,r);const h=c.next;if(!F(h))return h;let f;try{c=await n.adapter(r)}catch(d){f=d}if(f){if(F(n.readOnError)?n.readOnError(f,r):n.readOnError)try{return n.acceptStale=!0,c=await D(n,r),c.next.request.stale=!0,c.next}catch(a){}throw f}return h(c)}return{adapter:t,config:e,store:e.store}}export{me as setupCache};
